<div class="home-layout">

  <!-- Sidebar -->
  <app-sidebar class="sidebar"></app-sidebar>

  <!-- Main content split into 2 halves -->
  <div class="main-content">

    <!-- LEFT HALF — KPIs + Patients UNDER them -->
    <div class="kpi-section">

      <div>

        <!-- KPI CARDS -->
        <div class="kpi-cards">

          <div class="kpi-row">
            <div class="kpi-card small">
              <h3>Débit</h3>
              <p>{{ debit | number }} DT</p>
            </div>

            <div class="kpi-card small">
              <h3>Crédit</h3>
              <p>{{ credit | number }} DT</p>
            </div>
          </div>

          <div class="kpi-card">
            <h3>Profit</h3>
            <p>{{ profit | number }} DT</p>
          </div>

        </div>

        <!-- PATIENTS UNDER KPIs (FIXED POSITION!) -->
        <div class="patients-under-kpi">
          <h2>Patients</h2>

          <div class="patients-grid">
            <ng-container *ngFor="let p of displayedPatients">
              <app-patient-card 
                [patient]="p" 
                (select)="showPatientData($event)">
              </app-patient-card>
            </ng-container>
          </div>
        </div>

      </div>

      <!-- POPUP -->
      <div *ngIf="isRecordPopupVisible" class="record-popup">
        <app-record
          [patient]="selectedPatient"
          (save)="handleSave($event)"
          (cancel)="handleCancel()">
        </app-record>
      </div>

    </div> <!-- END LEFT HALF -->

    <!-- RIGHT HALF — Calendar -->
    <div class="calendar-section">
      <mwl-calendar-day-view
        [viewDate]="viewDate"
        [events]="events">
      </mwl-calendar-day-view>
    </div>

  </div>

</div>
